{% extends 'base.html' %}

{% block menu %}
<a class="header item" href="/datasets/">Главная</a>
<a class="header active item">{{ dataset_info.dataset_name }}</a>
{% endblock %}

{% block content %}
<div class="ui container padded-container">
    <h1 class="ui header">{{ dataset_info.dataset_name }}</h1>
    <div class="ui two column grid">
        <div class="column">
            <div class="ui segment">
                <div class="ui header">Описание</div>
                {% if dataset_info.dataset_description != '' %}
                <p>{{ dataset_info.dataset_description }}</p>
                {% else %}
                <p>(Без описания)</p>
                {% endif %}
            </div>
        </div>


        <div class="column">
            <div class="ui segment">
                <div class="ui header">Характеристики</div>
                <ul>
                    <li>Автор: <b>{{ dataset_info.dataset_author }}</b></li>
                    <li>Размер файла: {{ dataset_info.dataset_size }} кбайт</li>
                    <li>Количество столбцов: {{ dataset_info.dataset_columns }}</li>
                    <li>Количество записей: {{ dataset_info.dataset_rows }}</li>
                    <li>Дата создания: {{ dataset_info.dataset_creation_date }}</li>
                    <li>Текущая версия: {{ dataset_info.dataset_version }}</li>

                    {% if dataset_info.dataset_last_editor %}
                    <li>Последний редактор: {{ dataset_info.dataset_last_editor }}</li>
                    {% endif %}
                    {% if dataset_info.dataset_last_update %}
                    <li>Последнее обновление: {{ dataset_info.dataset_last_update }}</li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>

    <div class="ui container padded-container">
        <a class="ui secondary button"
           href="/dataset/download/{{ dataset_info.dataset_id }}">
            Скачать
        </a>
        <a class="ui basic secondary button" href="/datasets/edit/{{ dataset_info.dataset_id }}/">Редактировать</a>
        <a class="ui negative button" onclick="deleteDataset('{{ dataset_info.dataset_id }}')" href="/datasets/">
            Удалить
        </a>
        <a class="ui right floated button" href="/datasets/">Назад</a>
    </div>

    <div class="ui divider"></div>
</div>

<div class="table-wrapper">
    <div class="table-container">
        <table class="data-table">
            {% if dataset_info.dataset_columns > max_cols_num %}
            <h3>{{ 'В датасете слишком много столбцов (' ~ dataset_info.dataset_columns ~ '). В таблице отобразятся первые ' ~ max_cols_num}}</h3>
            {% endif %}
            <colgroup>
                {% for _ in headers %}
                <col style="min-width: 120px; width: auto">
                {% endfor %}
            </colgroup>
            <thead>
                <tr>
                    {% for header in headers %}
                    <th>{{ header }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                <!-- Image row -->
                <tr class="image-row">
                    {% set lst_ind = namespace(count=0) %}
                    {% if dataset_info.dataset_columns > max_cols_num %}
                        {% set col_lim = max_cols_num %}
                    {% else %}
                        {% set col_lim = dataset_info.dataset_columns %}
                    {% endif %}

                    {% for col_ind in range(col_lim) %}
                        <td>
                            <div class="image-cell">
                                {% if lst_ind.count < plots|length and col_ind == plots[lst_ind.count].name|int %}
                                    {{ plots[lst_ind.count].data|safe }}
                                    {% set lst_ind.count = lst_ind.count + 1 %}
                                {% endif %}
                            </div>
                        </td>
                    {% endfor %}
                </tr>

                <!-- Regular rows -->
                {% for row in rows %}
                <tr>
                    {% for cell in row %}
                    <td>{{ cell }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="ui divider"></div>

<div class="ui styled fluid accordion" id="activity">
    <div class="title">
        <i class="dropdown icon"></i>
        <span class="header">Активность</span>
    </div>

    <div class="content">
        <div class="ui two column stackable grid">
            <div class="column">
                <div class="ui header">Просмотры</div>
                <canvas id="views-plot"></canvas>
            </div>
            <div class="column">
                <div class="ui header">Загрузки</div>
                <canvas id="downloads-plot"></canvas>
            </div>
        </div> 
    </div>
</div>
<br>
{% endblock %}

{% block extra %}
<script src="{{ url_for('static', filename='scripts/datasetScripts.js') }}"></script>
<script>createViewsDownloadsPlots("{{ dataset_activity.statistics }}")</script>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}
